# 反共享机制快速测试清单

> 配置：MAX_DEVICES=2, CITY_CHECK_START_INDEX=1, RATE_LIMITS={1:2, 2:4}

---

## 核心功能测试

### ✅ 基础功能
- [√] 1. 首次激活成功
- [√] 2. 同设备同城市访问成功
- [√] 3. 访问次数超限拦截（第3次访问被拦截）

### ✅ 设备数限制
- [ ] 4. 第2台设备添加成功（同城市）
- [ ] 5. 第3台设备被拦截（设备数超限）

### ✅ 城市检测
- [√] 6. 第1台设备换城市：允许（不检测）
- [ ] 7. 第2台设备+新城市：拦截（共享检测）
- [ ] 8. 第2台设备+已有城市：允许
- [ ] 9. 已存在设备换城市：拦截（代理检测）

### ✅ Telegram通知
- [ ] 10. 激活通知正确
- [ ] 11. 新设备绑定成功通知正确
- [ ] 12. 设备数超限通知正确
- [ ] 13. 新设备新城市通知正确
- [ ] 14. 城市异常通知正确
- [ ] 15. 访问次数超限通知正确

---

## 测试进度
- **完成**: ___/15
- **发现问题**: ___个

---

## 快速测试步骤

### 准备
```bash
# 1. 生成测试Token
POST /api/batch-generate
{
  "profileId": "test",
  "count": 1,
  "duration": 1
}

# 2. 记录Token
Token: ______
```

### 测试序列

#### A组：基础+访问次数（用Token A）
```bash
# 1. Shadowrocket/Tokyo 激活
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenA
→ [ ] ✅ 成功 + Telegram通知

# 2. Shadowrocket/Tokyo 第2次
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenA
→ [ ] ✅ 成功

# 3. Shadowrocket/Tokyo 第3次
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenA
→ [ ] ❌ 访问次数超限 + Telegram通知
```

#### B组：多设备+城市检测（用Token B）
```bash
# 1. Shadowrocket/Tokyo 激活
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenB
→ [ ] ✅ 成功

# 2. Loon/Phoenix 新设备新城市
curl -H "User-Agent: Loon/904" https://domain.com/publicshare/test/tokenB
→ [ ] ❌ 新设备新城市 + Telegram通知

# 3. Loon/Tokyo 新设备已有城市
curl -H "User-Agent: Loon/904" https://domain.com/publicshare/test/tokenB
→ [ ] ✅ 成功

# 4. Loon/Phoenix 已存在设备换城市
curl -H "User-Agent: Loon/904" https://domain.com/publicshare/test/tokenB
→ [ ] ❌ 城市异常 + Telegram通知
```

#### C组：设备数超限（用Token C）
```bash
# 1-2. 添加2台设备
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenC
curl -H "User-Agent: Loon/904" https://domain.com/publicshare/test/tokenC
→ [ ] ✅ 2台设备添加成功

# 3. 第3台设备
curl -H "User-Agent: Surge/5.0" https://domain.com/publicshare/test/tokenC
→ [ ] ❌ 设备数超限 + Telegram通知
```

#### D组：第1台设备换城市（用Token D）
```bash
# 1. Shadowrocket/Tokyo 激活
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenD
→ [ ] ✅ 成功

# 2. Shadowrocket/Phoenix 同设备换城市
curl -H "User-Agent: Shadowrocket/2832" https://domain.com/publicshare/test/tokenD
→ [ ] ✅ 成功（CITY_CHECK_START_INDEX=1，第1台不检测）
```

---

## 问题记录
```
发现的问题：

1. 

2. 

3. 
```

---

## 完整测试清单
详见：[反共享机制测试清单.md](./反共享机制测试清单.md)
